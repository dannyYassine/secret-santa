dist: xenial
os: linux
language: php
cache:
  directories:
  - client/node_modules
  - api/vendor
branches:
  only:
  - main
jobs:
  include:
  - stage: install-dependencies
    language: php
    php: 7.4.12
    before_script:
    - cd api
    script:
    - composer install
  - stage: test
    language: php
    php: 7.4.12
    before_script:
    - cd api
    - cp .env.example .env
    - php artisan key:generate
    script:
    - php artisan test
  - stage: api-deploy
    language: node_js
    node_js: 14.15.1
    script:
    - echo *** DEPLOYING ***
    deploy:
      provider: heroku
      api_key:
        secure: ggYIBiV5LcAVE1q9DFrK9gspvPz3ihU9iOENQbZ2dQuKuG3lQsNN6pW4u5Lv8afaFqwERqSNR5NbrOhZ76Sv7281pCekAZhPGEU8Qdd+coM0wqOvE+vagrQW7Eih4VB9rpO17K8oUCAixh6ys0KeX9nSiL2aPXZIFFqpOPy+GYkd0N6LvzaUrrKthmzioBhRq4rgeNX/nVi3JFGyV6fMWFe62qwZTYX38QWY6qkBIaXbVSR+I49cCgU38FDy9JlkrhUwo68p/JmJSVyaJdMThgjnENo+22ot1qMupDL3qZ0H//j+9o7bdKhO2qATQd/M/XnlIuoTjp6MyRU+TRxX9wTc6uq0NF8TcX1owns83pZ9YIhHWe9qdRF+yHG5UsR+5lVhm9+tMtwCCMl4JTsZllKJul6O97Dk20jau4hBcetLQhgQuoNft8APDAss1wuo8X+10mGAfS63SzcS+jgm5SKUtelbBgo+6K1oeyGvz2hCfFulibs2c8PXlEDj7sjhF16DdDoYj0R3WmxwRjjpz/c3IIHZRfk6rB4Lqvp25V+UrWhGB9zhQTAC7FHbZNV6/VrZ7rcKtyCxt03seS2NnH5f917C8OQsISfUEaUP8mb9r6qx0ZZtEsDl0yN7cAYPzdBzKWJK/Oal2aH1UE7JWqVLtPJapNyXaaHhEcI/izU=
      app: dannyyassine-secret-santa
      on: main
  - stage: install-dependencies
    language: node_js
    node_js: 14.15.1
    before_script:
    - cd client
    script:
    - yarn install
  - stage: test
    language: node_js
    node_js: 14.15.1
    before_script:
    - cd client
    script:
    - yarn test
  - stage: client-deploy
    language: node_js
    node_js: 14.15.1
    script: skip
    deploy:
      provider: firebase
      token:
        secure: ePXdrECuUbcc8qPDwgVA9GC0ovxbACKTRxvbKPwzuNP5i0K5DedIquhEaLEWHFzAUYy+NCkiqOa7aMAZ9Fx6KyGRp7boahCyMHe2Bw+CWBZP1AGHCyUIaCcnOA71S9xXWqrWcpC0eO/XzdnEFt3ZJGFoX1ct2Y1AHskhXAAjIx+jyX+ldm9ouEzSRd4YNDHeHj8fmLOuIp68JH4kZx/6hHdVbxlKoiBCFxF/wswWu7tAu0qMTwyHKvT1RX+iBk8ayoZAaK5YGvJSl1i7+CFGxTTp5dxey8pQzWBCLYXB8BDcnZ3VMUxPINubzhr8vnjE+Tm+FHB8TIVVk9h+daKm2I6Y4Vr1vtkC/yqLkcBY0JhKdH28D52m4RBTLwTg4iJ/j2F8drZns/S+WM41x/nF6058hMLIJRf9x2qm3rAAPPxN5Wl6IJB3H+uUsVISrfHeBTTdbLbx8Zn+DMPLVwKHYXw+I3DBvQG6mojax6A/x+7RajsskV0BaP3LlbU0f5t6fpdUsinGjvxAvMAf9MCielCvmOGv7tQkP/gtv0hdH22Bxi0M7nRGU6cUGBysoxlPxYcMj4hhwjfru3XjT/q3EGLaAyq/lz6JMLxH3xjVvHuYA+XLrpAlHG0zFx+dWkRWAyVArYvUCDiHKZ0JecmXq1JeK/aILcsrY5/dM1MmCl4=
      project: virtual-secret-santa
stages:
- install-dependencies
- test
- api-deploy
- client-deploy
